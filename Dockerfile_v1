# Используем официальный Python образ
FROM python:3.11-slim

# Устанавливаем системные зависимости (исправлены для Debian Trixie)
RUN apt-get update && apt-get install -y \
    build-essential \
    cmake \
    libopenmpi-dev \
    gfortran \
    libomp-dev \
    libopenblas-dev \
    liblapack-dev \
    pkg-config \
    && rm -rf /var/lib/apt/lists/*

# Рабочая директория в контейнере
WORKDIR /app

# Копируем requirements.txt
COPY requirements.txt ./

# Устанавливаем Python зависимости
RUN pip install --no-cache-dir -r requirements.txt

# Копируем приложение
COPY app/ ./app/

# Создаём папки для данных
RUN mkdir -p /app/models /app/data /app/logs

# Открываем порт для Gradio
EXPOSE 7861

# Команда запуска
CMD ["python", "app/saiga_chat.py"]
